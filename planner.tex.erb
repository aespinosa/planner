\setuppapersize[A6][A6]
\setuppagenumbering[state=stop]

\def\translate{}

\def\stripzero#1{\expandafter\stripzerohelp#1}
\def\stripzerohelp#1{\ifx 0#1\expandafter\stripzerohelp\else#1\fi}

\starttext

Planner 2016

\page[yes]
<% Date.new(2016, 3, 1).upto(Date.new(2016, 3, -1)) do |date| %>
  <% if date.day == 1 && !date.monday? %>
\bTABLE

\bTABLEhead
\bTR
  \bTH Weekly Plan \eTH
  \bTH Monday \eTH
  \bTH Tuesday \eTH
  \bTH Wednesday \eTH
\eTR
\eTABLEhead
\bTABLEbody

  \bTR
    <% date.wday.times do %>
    \bTD \eTD
      <% end %>
  \eTR
  <% end %>
  <% if date.monday? %>
  \bTR \bTD \eTD
  <% end %>
  <% if date.monday? || date.tuesday? || date.wednesday? %>
  \bTD <%= date.day %>\eTD
  <% end %>
  <% if date.wednesday? %>
  \eTR
  <% end %>
  <% if date.day == Date.new(date.year, date.month, -1).day %>
  \bTR \bTD[n=4] memo \eTD \eTR
  <% end %>
<% end %>

\eTABLEbody
\eTABLE


\page[yes]
<% Date.new(2016, 3, 1).upto(Date.new(2016, 3, -1)) do |date| %>
  <% if date.day == 1 && !date.monday? %>
\bTABLE

\bTABLEhead
\bTR
  \bTH Thursday \eTH
  \bTH Friday \eTH
  \bTH Saturday \eTH
  \bTH Sunday \eTH
\eTR
\eTABLEhead
\bTABLEbody

  \bTR
    <% (date.wday - 3).times  do %>
    \bTD \eTD
      <% end %>
  \eTR
  <% end %>
  <% if date.monday? %>
  \bTR 
  <% end %>
  <% if date.thursday? || date.friday? || date.saturday? || date.sunday? %>
    \bTD <%= date.day %>\eTD
  <% end %>
  <% if date.day == Date.new(date.year, date.month, -1).day && !date.sunday? %>
    <% (7 - date.wday).times do %>
    \bTD \eTD
    <% end %>
  \eTR
  <% end %>
  <% if date.sunday? %>
  \eTR
  <% end %>
  <% if date.day == Date.new(date.year, date.month, -1).day %>
  \bTR \bTD[n=4] memo \eTD \eTR
  <% end %>
<% end %>

\eTABLEbody
\eTABLE


\page[yes]

<% Date.new(2016, 2, -1).upto(Date.new(2016, 3, -1)) do |date| %>
  <% if date.monday? %>
    \setupheadertexts[
      <%= date.month %>
      <%= date.to_time.strftime('%b') %>
    ]
    \hrule

    notes and a month calendar
    \vfill

    \hrule
  <% end %>
  <% if date.thursday? %>
    \setupheadertexts[<%= date.year %>]
    \hrule
  <% end %>

    <%= date.day %>
    <%= date.to_time.strftime('%a') %>
    \vfill
    \hrule

  <% if date.sunday? || date.wednesday? %>
    \page[yes]
  <% end %>
<% end %>

\stoptext
